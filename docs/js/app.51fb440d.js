(function(e){function t(t){for(var n,r,i=t[0],s=t[1],l=t[2],d=0,p=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&p.push(o[r][0]),o[r]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);u&&u(t);while(p.length)p.shift()();return c.push.apply(c,l||[]),a()}function a(){for(var e,t=0;t<c.length;t++){for(var a=c[t],n=!0,i=1;i<a.length;i++){var s=a[i];0!==o[s]&&(n=!1)}n&&(c.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},o={app:0},c=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=s;c.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"56d7":function(e,t,a){"use strict";a.r(t);a("3b18");var n=a("f64c"),o=(a("fbd6"),a("160c")),c=(a("0032"),a("e32c")),r=(a("de6a"),a("9a63")),i=(a("5704"),a("b558")),s=(a("438c"),a("fbdf")),l=(a("2ef0"),a("9839")),u=(a("6ba6"),a("5efb")),d=(a("e260"),a("e6cf"),a("cca6"),a("a79d"),a("2b0e")),p=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("router-view")],1)},f=[],h=(a("5c0b"),a("2877")),m={},g=Object(h["a"])(m,p,f,!1,null,null,null),v=g.exports,b=(a("6d37"),a("9483"));console.log("production"),Object(b["a"])("".concat("","sw.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var y,w,S,x=a("8c4f"),_=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"home"},[a("p",{staticStyle:{"font-size":"20px","font-weight":"bold"}},[e._v("大声朗读")]),a("p",{staticStyle:{"margin-bottom":"30px",color:"#999"}},[e._v(" 基于微软 Edge 浏览器大声朗读功能开发的 PWA 应用 ")]),a("p",{staticClass:"text-lf pb5 fweight-bold letter2 pl5 mt30"},[e._v("B站直播间号")]),a("a-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{attrs:{span:17}},[a("a-input",{attrs:{placeholder:"直播间号",value:e.roomId},on:{input:e.onInputRoomId}})],1),a("a-col",{attrs:{span:3}},[a("a-button",{attrs:{type:"primary"},on:{click:e.onConnect}},[e._v("连接")])],1),a("a-col",{attrs:{span:3}},[a("a-button",{attrs:{type:"primary"},on:{click:e.onDisconnect}},[e._v("断开")])],1)],1),a("p",{staticClass:"text-lf pb5 fweight-bold letter2 pl5 mt30"},[e._v("读出内容")]),a("a-row",{staticClass:"pb10",attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{staticClass:"flex-wrap"},[a("p",{staticClass:"text-lf fweight-bold letter2 pl5 pb10",staticStyle:{"margin-right":"10px"}},[e._v("弹幕")]),a("a-switch",{attrs:{checked:e.readDanmu},on:{change:e.onChangeDanmu}})],1),a("a-col",{staticClass:"flex-wrap"},[a("p",{staticClass:"text-lf fweight-bold letter2 pl5 pb10",staticStyle:{"margin-right":"10px"}},[e._v("礼物")]),a("a-switch",{attrs:{checked:e.readGift},on:{change:e.onChangeGift}})],1),a("a-col",{staticClass:"flex-wrap"},[a("p",{staticClass:"text-lf fweight-bold letter2 pl5 pb10",staticStyle:{"margin-right":"10px"}},[e._v("欢迎")]),a("a-switch",{attrs:{checked:e.readWelcome},on:{change:e.onChangeWelcome}})],1)],1),a("a-row",{staticClass:"pb5 pt20",attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{attrs:{span:24}},[a("div",{staticClass:"text-lf"},[a("span",{staticClass:"text-lf fweight-bold letter2 pl5"},[e._v("弹幕朗读概率")]),a("span",{staticClass:"letter2 pl10",staticStyle:{color:"#999","font-size":"12px"}},[e._v("当前 "+e._s(e.readRate)+" %")])]),a("div",{staticStyle:{"padding-left":"10px"},attrs:{"touch-action":"none"}},[a("a-slider",{attrs:{step:1,min:0,max:100,value:e.readRate},on:{change:e.onReadRateSlider}})],1)])],1),a("a-textarea",{staticClass:"a-textarea",staticStyle:{"margin-top":"10px"},attrs:{placeholder:"已经朗读的弹幕",value:e.readTextLog,rows:8},on:{input:e.onInputReadTextLog}}),a("a-textarea",{staticClass:"a-textarea",staticStyle:{"margin-top":"10px"},attrs:{placeholder:"输入需要测试朗读的文字",value:e.inputText,rows:1},on:{input:e.onInput}}),a("p",{staticClass:"text-lf pb5 fweight-bold letter2 pl5 mt30"},[e._v("选择语音")]),a("a-row",{attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{attrs:{span:18}},[a("a-select",{staticStyle:{width:"100%"},attrs:{"default-value":e.defaultSelect,value:e.selectIdx},on:{select:e.onSelect}},e._l(e.voices,(function(t,n){return a("a-select-option",{key:n},[e._v(" "+e._s(t.displayName)+" ")])})),1)],1),a("a-col",{attrs:{span:4}},[a("a-button",{attrs:{type:"primary",id:"play"},on:{click:e.onClick}},[e._v("播放测试")])],1)],1),a("a-row",{staticClass:"pb5 pt10 mt20",attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{attrs:{span:24}},[a("div",{staticClass:"text-lf"},[a("span",{staticClass:"fweight-bold letter2 pl5"},[e._v("播放音量")]),a("span",{staticClass:"letter2 pl10",staticStyle:{color:"#999","font-size":"12px"}},[e._v("当前 "+e._s(e.volumeValue))])]),a("div",{staticStyle:{"padding-left":"10px"},attrs:{"touch-action":"none"}},[a("a-slider",{attrs:{step:1,min:0,max:100,value:e.volumeValue},on:{change:e.onVolumeSlider}})],1)])],1),a("a-row",{staticClass:"pb5 pt10 mt20",attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{attrs:{span:24}},[a("div",{staticClass:"text-lf"},[a("span",{staticClass:"fweight-bold letter2 pl5"},[e._v("播放速度")]),a("span",{staticClass:"letter2 pl10",staticStyle:{color:"#999","font-size":"12px"}},[e._v(e._s(e.rateValue)+" 倍速")])]),a("div",{staticStyle:{"padding-left":"10px"},attrs:{"touch-action":"none"}},[a("a-slider",{attrs:{marks:e.rateMarks,step:.25,min:e.minRate,max:e.maxRate,included:!1,value:e.rateValue},on:{change:e.onRateSlider}})],1)])],1),a("a-row",{staticClass:"pb5 pt20",attrs:{type:"flex",justify:"space-between",align:"middle"}},[a("a-col",{attrs:{span:24}},[a("div",{staticClass:"text-lf"},[a("span",{staticClass:"text-lf fweight-bold letter2 pl5"},[e._v("音调调整")]),a("span",{staticClass:"letter2 pl10",staticStyle:{color:"#999","font-size":"12px"}},[e._v("当前"+e._s(e.pitchValue))])]),a("div",{staticStyle:{"padding-left":"10px"},attrs:{"touch-action":"none"}},[a("a-slider",{attrs:{marks:e.pitchMarks,step:.1,min:e.minPitch,max:e.maxPitch,value:e.pitchValue,included:!1},on:{change:e.onPitchSlider}})],1)])],1),a("a",{staticClass:"link",attrs:{href:"https://github.com/demojameson/ReadAloud"}},[e._v("查看 Github 项目源码")])],1)},C=[],k=a("1da1"),R=a("53ca"),I=a("2909"),V=(a("96cf"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("d3b7"),a("99af"),a("fb6a"),a("1276"),a("ac1f"),a("159b"),a("466d"),a("caad"),a("2532"),a("07ac"),a("5319"),a("843c"),a("4e82"),a("d81d"),a("2ca0"),a("b0c0"),a("c740"),a("7db0"),a("4de4"),a("d7ac")),T=a.n(V),j=new TextEncoder("utf-8"),O=new TextDecoder("utf-8"),D=function(e,t,a){for(var n=0,o=a-1;o>=0;o--)n+=Math.pow(256,a-o-1)*e[t+o];return n},N=function(e,t,a,n){var o=0;while(o<a)e[t+o]=n/Math.pow(256,a-o-1),o++},M=function(e,t){var a=j.encode(e),n=16+a.byteLength,o=[0,0,0,0,0,16,0,1,0,0,0,t,0,0,0,1];return N(o,0,4,n),new Uint8Array(o.concat.apply(o,Object(I["a"])(a))).buffer},G=function(e){return new Promise((function(t){var a=new FileReader;a.onload=function(e){var a=new Uint8Array(e.target.result),n={};if(n.packetLen=D(a,0,4),n.headerLen=D(a,4,2),n.ver=D(a,6,2),n.op=D(a,8,4),n.seq=D(a,12,4),5===n.op){n.body=[];var o=0;while(o<a.length){var c=D(a,o,4),r=16,i=a.slice(o+r,o+c),s="";try{s=O.decode(T.a.inflate(i))}catch(e){s=O.decode(i)}if(s){var l=s.split(/[\x00-\x1f]+/);l.forEach((function(t){try{var a=JSON.parse(t);"object"===Object(R["a"])(a)&&n.body.push(a)}catch(e){}}))}o+=c}}else 3===n.op&&(n.body={count:D(a,16,4)});t(n)},a.readAsArrayBuffer(e)}))},A=window.speechSynthesis,E={},P=[],W=[/^www$/,/^[^\w\u4e00-\u9fa5]+$/];function L(e){return e.length<2||W.some((function(t){return e.match(t)}))||Object.values(E).includes(e)}function U(e){return e.replace(/(?<!\d)233+(?!\d)/g,(function(e){return"二".padEnd(e.length,"三")}))}var $={name:"Home",data:function(){return{voices:[],value:"",value1:20,disabled:!1,defaultSelect:"选择朗读语言类型",speedSelect:"x1",inputText:"",readTextLog:"",roomId:"",selectIdx:0,selectVoice:{},rateValue:1.25,minRate:.5,maxRate:2,rateMarks:{.5:"缓慢",.75:"",1:"常规",1.25:"",1.5:"",1.75:"",2:"快"},volumeValue:100,readRate:100,pitchValue:1,minPitch:0,maxPitch:2,pitchMarks:{0:"",2:""},recordStatus:!1,readDanmu:!0,readGift:!1,readWelcome:!1}},created:function(){},beforeMount:function(){},mounted:function(){this.populateVoiceList(),this.checkBrowser(),localStorage.roomId&&(this.roomId=localStorage.roomId),localStorage.readDanmu&&(this.readDanmu="true"===localStorage.readDanmu),localStorage.readGift&&(this.readGift="true"===localStorage.readGift),localStorage.readWelcome&&(this.readWelcome="true"===localStorage.readWelcome),localStorage.readRate&&(this.readRate=parseInt(localStorage.readRate)),localStorage.rateValue&&(this.rateValue=parseFloat(localStorage.rateValue)),localStorage.volumeValue&&(this.volumeValue=parseInt(localStorage.volumeValue))},watch:{roomId:function(e){localStorage.roomId=e},readDanmu:function(e){localStorage.readDanmu=e},readGift:function(e){localStorage.readGift=e},readWelcome:function(e){localStorage.readWelcome=e},readRate:function(e){localStorage.readRate=e},rateValue:function(e){localStorage.rateValue=e},volumeValue:function(e){localStorage.volumeValue=e}},updated:function(){},beforeDestroy:function(){},methods:{populateVoiceList:function(){var e=this;"undefined"!==typeof speechSynthesis&&new Promise((function(e,t){setTimeout((function(){var t=speechSynthesis.getVoices();e(t)}),0)})).then((function(t){e.voices=t.map((function(e){return e.name.startsWith("Google ")?e.displayName=e.name.replace(/^Google /,""):e.name.startsWith("Microsoft")?(e.name.match(/^Microsoft (.+) Online.*- (.+)/),e.displayName=e.name):e.displayName=e.name,e})).sort((function(e,t){var a=e.displayName.replace(/^.+-/,""),n=t.displayName.replace(/^.+-/,"");return a.localeCompare(n)}));var a=e.voices.findIndex((function(e){return e.displayName.includes("Xiaoxiao")}));a>=0&&(e.selectIdx=a)}))},test:function(){A.resume(),this.$message.success("继续播放")},onClick:function(){this.inputText&&0!==this.inputText.length&&this.speak(this.inputText)},onConnect:function(){var e=this;w&&(w.close(),clearInterval(S));var t=this.roomId.replace("https://live.bilibili.com/",""),a=encodeURIComponent("https://api.live.bilibili.com/room/v1/Room/room_init?id=".concat(t));fetch("https://json2jsonp.com/?url=".concat(a,"&callback=result")).then((function(e){return e.text()})).then((function(a){var n=a.replace(/^result\((.+)\)$/,"$1"),o=JSON.parse(n);console.log("roomId 从 ".concat(t," 转为 ").concat(o.data.room_id));var c=o.data.room_id;w=new WebSocket("wss://broadcastlv.chat.bilibili.com/sub"),w.onopen=function(){w.send(M(JSON.stringify({roomid:parseInt(c)}),7)),console.log("connect roomid: "+t),e.speak("连接房间："+t),o.data.live_status||e.speak("主播正在摸鱼")},S=setInterval((function(){w.send(M("",2))}),3e4),w.onmessage=function(){var t=Object(k["a"])(regeneratorRuntime.mark((function t(a){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,G(a.data);case 2:n=t.sent,t.t0=n.op,t.next=8===t.t0?6:3===t.t0?8:5===t.t0?11:13;break;case 6:return console.log("ws.onmessage：加入房间"),t.abrupt("break",14);case 8:return o=n.body.count,console.log("人气：".concat(o)),t.abrupt("break",14);case 11:return n.body.forEach((function(t){switch(console.log(t),t.cmd){case"ANCHOR_LOT_START":E[t.data.id]=t.data.danmu,console.log("天选之人开始，弹幕："+t.data.danmu);break;case"ANCHOR_LOT_END":console.log("天选之人结束，弹幕："+E[t.data.id]),E[t.data.id]=void 0;break;case"DANMU_MSG":if(e.readDanmu){var a=t.info[2][1].replace(/_*bili_*/g,""),n=t.info[2][0];12695494===n?a="串串":21222===n&&(a="DJ"),console.log(t.info[2]);var o=t.info[1],c="".concat(a,"说: ").concat(o);e.readRate>=Math.round(100*Math.random())?L(o)?console.log("无意义被过滤的弹幕：".concat(c)):(c=U(c),e.speak(c)):console.log("因为朗读概率忽略的弹幕：".concat(c))}break;case"SUPER_CHAT_MESSAGE":case"SUPER_CHAT_MESSAGE_JPN":if(e.readDanmu){var r="收到来自".concat(t.data.user_info.uname,"的醒目留言：").concat(t.data.message);e.speak(r)}break;case"USER_TOAST_MSG":if(e.readDanmu){var i=t.data.toast_msg.replace("<%","").replace("%>","");e.speak(i)}break;case"SEND_GIFT":if(e.readGift){var s=t.data.uname,l=t.data.giftName,u=t.data.num,d="收到来自".concat(s,"的").concat(u,"个").concat(l),p=P.find((function(e){return e.userName===s&&e.giftName===l}));p?(clearTimeout(p.timeoutId),p.num+=u,d="收到来自".concat(s,"的").concat(p.num,"个").concat(l),console.log("合并礼物信息：".concat(d))):(p={userName:s,giftName:l,num:u},P.push(p)),p.timeoutId=setTimeout((function(){e.speak(d),P=P.filter((function(e){return e!==p}))}),5e3)}break;case"GUARD_BUY":var f="欢迎".concat(t.data.username,"加入大航海");e.speak(f);break;case"WELCOME":if(e.readWelcome){var h="欢迎".concat(t.data.uname);e.speak(h)}break}})),t.abrupt("break",14);case 13:console.log(n);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}))},onDisconnect:function(e){w&&(w.close(),clearInterval(S),P.forEach((function(e){return clearTimeout(e.timeoutId)})),P.length=0,A.cancel(),this.speak("断开房间："+this.roomId.replace("https://live.bilibili.com/","")))},onReadRateSlider:function(e){this.readRate=e},onInput:function(e){this.inputText=e.target.value},onInputReadTextLog:function(e){this.readTextLog=e.target.value},onInputRoomId:function(e){this.roomId=e.target.value},onSelect:function(e){this.selectIdx=e},speak:function(e){var t=this.voices,a=this.selectIdx,n=this.rateValue,o=this.volumeValue,c=this.pitchValue;this.readTextLog="".concat((new Date).toLocaleTimeString(),"\t").concat(e,"\n").concat(this.readTextLog),0!==o&&(y=new SpeechSynthesisUtterance(e),y.onstart=function(){console.log("SpeechSynthesisUtterance.onstart: ".concat(e))},y.onerror=function(){console.error("SpeechSynthesisUtterance.onerror: ".concat(e))},y.voice=t[a],y.pitch=c,y.rate=n,y.volume=o/100,A.speak(y))},onChange:function(e){console.log("change: ",e),this.recordStatus||this.initRecorder(),this.recordStatus=!this.recordStatus},onChangeDanmu:function(e){console.log("onChangeDanmu: ",e),this.readDanmu=!this.readDanmu},onChangeGift:function(e){console.log("onChangeGift: ",e),this.readGift=!this.readGift},onChangeWelcome:function(e){console.log("onChangeWelcome: ",e),this.readWelcome=!this.readWelcome},onChangeVoice:function(e){console.log("onChangeVoice: ",e),this.selectVoice=e.displayName},onAfterChange:function(e){console.log("afterChange: ",e)},onRateSlider:function(e){this.rateValue=e},onVolumeSlider:function(e){this.volumeValue=e},onPitchSlider:function(e){this.pitchValue=e},checkBrowser:function(){},initRecorder:function(){var e=this,t=window.constraints={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(t).then((function(t){e.recorderFn(t),console.log(t)})).catch((function(t){console.log(t),e.recordStatus=!1,e.$message.warning("🙅🏻‍♀️ 拒绝录音权限")}))},recorderFn:function(e){var t=new MediaRecorder(e);t.start(),console.log("录音中...")}}},F=$,J=(a("abd5"),Object(h["a"])(F,_,C,!1,null,"75fa09e7",null)),B=J.exports;d["a"].use(x["a"]);var H=[{path:"/",name:"Home",component:B}],z=new x["a"]({routes:H,mode:"hash"});d["a"].config.productionTip=!1,d["a"].use(u["a"]),d["a"].use(l["a"]),d["a"].use(s["a"]),d["a"].use(i["a"]),d["a"].use(r["a"]),d["a"].use(c["a"]),d["a"].use(o["a"]),d["a"].prototype.$message=n["a"],new d["a"]({router:z,render:function(e){return e(v)}}).$mount("#app")},"5c0b":function(e,t,a){"use strict";a("9c0c")},"6d37":function(e,t,a){},"9c0c":function(e,t,a){},abd5:function(e,t,a){"use strict";a("f620")},f620:function(e,t,a){}});
//# sourceMappingURL=app.51fb440d.js.map